# AI Higress Gateway 环境变量示例
#
# 使用方式：
# 1. 复制本文件为 .env
# 2. 按需修改下方密码/密钥/回调地址
# 3. 运行开发镜像（推荐新手）：
#    IMAGE_TAG=latest docker compose -f docker-compose.develop.yml --env-file .env up -d
# 4. 生产部署：
#    IMAGE_TAG=latest docker compose -f docker-compose-deploy.yml --env-file .env up -d
#
# 说明：
# - 本示例默认面向 Docker 镜像/Compose 场景，因此 DATABASE_URL / REDIS_URL 使用容器内服务名
#   （postgres/redis），不要写本机回环地址。
# - 如果你选择“本地运行后端 + Docker 起数据库/Redis”，请参考各段落中的本机地址示例改写 URL。

# 运行环境与日志
APP_ENV=development
LOG_LEVEL=INFO

# CORS 配置（多个来源用英文逗号分隔）
# 前端在容器外访问时通常为 http(s)://你的域名 或 http://你的IP:3000
# 本地前端默认可用：http://127.0.0.1:3000
CORS_ALLOW_ORIGINS=http://your-frontend-domain-or-ip:3000
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=*
CORS_ALLOW_HEADERS=*

# 初始管理员（可自定义，首次启动自动创建）
DEFAULT_ADMIN_USERNAME=admin
DEFAULT_ADMIN_EMAIL=admin@example.com

# PostgreSQL 配置
POSTGRES_USER=apiproxy
POSTGRES_PASSWORD=change-me-postgres
POSTGRES_DB=apiproxy

# Docker 镜像模式（推荐）：后端容器通过 service 名访问数据库
DATABASE_URL=postgresql+psycopg://${POSTGRES_USER}:${POSTGRES_PASSWORD}@postgres:5432/${POSTGRES_DB}  # pragma: allowlist secret
# 本地运行后端（非容器）时可改为（compose 暴露端口默认 15432）：
# DATABASE_URL=postgresql+psycopg://${POSTGRES_USER}:${POSTGRES_PASSWORD}@127.0.0.1:15432/${POSTGRES_DB}  # pragma: allowlist secret

# Redis 配置
REDIS_PASSWORD=change-me-redis
# Docker 镜像模式（推荐）
REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
# 本地运行后端（非容器）时可改为（compose 暴露端口默认 16379）：
# REDIS_URL=redis://:${REDIS_PASSWORD}@127.0.0.1:16379/0

# Celery 配置（默认复用同一 Redis）
CELERY_BROKER_URL=${REDIS_URL}
CELERY_RESULT_BACKEND=${REDIS_URL}

# 自动执行数据库迁移（建议保持 true，避免首次启动遗漏）
AUTO_APPLY_DB_MIGRATIONS=true
# 是否在启动时真正执行迁移（需与 AUTO_APPLY_DB_MIGRATIONS=true 同时开启）
ENABLE_AUTO_MIGRATION=false

# 安全中间件开关：true 强制开启，false 强制关闭；默认仅在 APP_ENV=production 时启用
ENABLE_SECURITY_MIDDLEWARE=false

# 应用密钥（用于 JWT/HMAC/加密等敏感标识）
# 请使用系统 API POST /system/secret-key/generate 生成随机值并替换
SECRET_KEY=change-me-secret-key

# LinuxDo OAuth2（可选，启用后可使用 LinuxDo 登录）
LINUXDO_OAUTH_ENABLED=false
LINUXDO_CLIENT_ID=
LINUXDO_CLIENT_SECRET=
# 回调地址必须是你实际可访问的域名（不要使用本机回环地址），例如：https://ai.example.com/callback
LINUXDO_REDIRECT_URI=https://your-domain.com/callback

# 上游请求代理池（可选，用于轮换出口 IP，降低单一 IP 被上游风控/封禁风险）
# 多个代理 URL 用英文逗号或换行分隔；为空表示直连。
# 支持 http(s):// 与 socks5(h)://，例如：
# UPSTREAM_PROXY_POOL=http://user:pass@1.2.3.4:8080, socks5://5.6.7.8:1080
# 选择策略：random（默认，随机挑选） / round_robin（轮询）
UPSTREAM_PROXY_POOL=
UPSTREAM_PROXY_STRATEGY=random
# 同一次上游请求内，代理连接失败时的换代理重试次数（0 表示不重试）
UPSTREAM_PROXY_MAX_RETRIES=1
